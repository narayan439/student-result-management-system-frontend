<div class="track-recheck-container">
  <!-- Header -->
  <div class="page-header">
    <h1 class="page-title">Track Recheck Status</h1>
    <p class="page-subtitle">Monitor the progress of your re-evaluation requests</p>
  </div>

  <!-- Main Card -->
  <div class="track-card">
    <!-- Card Header -->
    <div class="card-header">
      <div>
        <h2>Your Recheck Requests</h2>
        <p>Track the status of all your submitted re-evaluation requests</p>
      </div>
      <div class="track-count">
        {{ totalRequests }} Request{{ totalRequests !== 1 ? 's' : '' }}
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-icon total">
          <mat-icon>description</mat-icon>
        </div>
        <div class="stat-content">
          <h3>{{ totalRequests }}</h3>
          <p>Total Requests</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon pending">
          <mat-icon>pending</mat-icon>
        </div>
        <div class="stat-content">
          <h3>{{ pendingRequests }}</h3>
          <p>Pending</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon approved">
          <mat-icon>check_circle</mat-icon>
        </div>
        <div class="stat-content">
          <h3>{{ approvedRequests }}</h3>
          <p>Approved</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon rejected">
          <mat-icon>cancel</mat-icon>
        </div>
        <div class="stat-content">
          <h3>{{ rejectedRequests }}</h3>
          <p>Rejected</p>
        </div>
      </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-container" *ngIf="totalRequests > 0">
      <div class="progress-title">
        <mat-icon>trending_up</mat-icon>
        Request Processing Overview
      </div>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="((approvedRequests + rejectedRequests) / totalRequests * 100)"></div>
      </div>
      <div class="progress-stats">
        <span>{{ ((approvedRequests + rejectedRequests) / totalRequests * 100) | number:'1.0-0' }}% Processed</span>
        <span>{{ totalRequests - (approvedRequests + rejectedRequests) }} Pending</span>
      </div>
    </div>

    <!-- Requests Table -->
    <div class="table-container">
      <div class="table-card">
        <table>
          <thead>
            <tr>
              <th>Subject</th>
              <th>Request Date</th>
              <th>Resolve Date</th>
              <th>Status</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor="let r of requests; let i = index">
              <!-- Main Request Row -->
              <tr class="request-row" (click)="toggleRequestDetails(i)" [class.expanded]="expandedRequestIndex === i">
                <td class="subject-cell">
                  {{ r.subject }}
                </td>
                <td>
                  {{ r.requestDate ? (r.requestDate | date:'MMM dd, yyyy') : '-' }}
                </td>
                <td>
                  {{ r.resolvedDate ? (r.resolvedDate | date:'MMM dd, yyyy') : '-' }}
                </td>
                <td class="status-cell">
                  <span class="status-badge" [ngClass]="getStatusClass(r.status)">
                    {{ getStatusText(r.status) }}
                  </span>
                </td>
                <td class="details-cell">
                  <button class="view-details-btn" (click)="toggleRequestDetails(i); $event.stopPropagation()">
                    <mat-icon>{{ expandedRequestIndex === i ? 'expand_less' : 'expand_more' }}</mat-icon>
                  </button>
                </td>
              </tr>

              <!-- Expanded Details Row -->
              <tr *ngIf="expandedRequestIndex === i" class="details-row">
                <td colspan="5" class="details-content">
                  <div class="request-details">
                    
                    <!-- Reason Section -->
                    <div class="detail-section">
                      <h4><mat-icon>description</mat-icon> Reason for Recheck</h4>
                      <p class="detail-text">{{ r.reason || 'No reason provided' }}</p>
                    </div>

                    <!-- Admin Notes Section -->
                    <div class="detail-section" *ngIf="r.adminNotes">
                      <h4><mat-icon>notes</mat-icon> Admin Notes</h4>
                      <p class="detail-text">{{ r.adminNotes }}</p>
                    </div>

                    <!-- Timeline Section -->
                    <div class="detail-section">
                      <h4><mat-icon>timeline</mat-icon> Timeline</h4>
                      <div class="timeline">
                        <div class="timeline-item">
                          <span class="timeline-label"><mat-icon>send</mat-icon> Requested:</span>
                          <span class="timeline-value">{{ r.requestDate ? (r.requestDate | date:'MMM dd, yyyy hh:mm a') : 'N/A' }}</span>
                        </div>
                        <div class="timeline-item" *ngIf="r.resolvedDate">
                          <span class="timeline-label"><mat-icon>check_circle</mat-icon> Resolved:</span>
                          <span class="timeline-value">{{ r.resolvedDate | date:'MMM dd, yyyy hh:mm a' }}</span>
                        </div>
                      </div>
                    </div>

                    <!-- Status Details Section -->
                    <div class="detail-section">
                      <h4><mat-icon>analytics</mat-icon> Status Details</h4>
                      <div class="status-details">
                        <div class="status-detail-item">
                          <span class="label">Current Status:</span>
                          <span class="status-badge" [ngClass]="getStatusClass(r.status)">
                            {{ getStatusText(r.status) }}
                          </span>
                        </div>
                        <div class="status-detail-item">
                          <span class="label">Request ID:</span>
                          <span class="request-id-badge">#{{ r.recheckId || 'N/A' }}</span>
                        </div>
                        <div class="status-detail-item">
                          <!-- <span class="label">Reviewed By:</span>
                          <span class="value">{{ r.reviewedBy || 'Not assigned' }}</span> -->
                        </div>
                      </div>
                    </div>

                  </div>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>

        <!-- Empty State -->
        <div *ngIf="requests.length === 0" class="empty-state">
          <div class="empty-icon">
            <mat-icon>inbox</mat-icon>
          </div>
          <h3>No Recheck Requests Found</h3>
          <p>You haven't submitted any re-evaluation requests yet.</p>
          <a routerLink="/student/request-recheck" class="empty-state-btn">
            <mat-icon>add</mat-icon> Submit New Request
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="track-footer">
    <p>Â© {{ year }} Sri Jayadev Shiksha Kendra. All rights reserved.</p>
    <p>
      Developed by
      <a href="https://github.com/narayan439" target="_blank" rel="noopener noreferrer">Narayan</a>
    </p>
    <p>Status updates are automatically refreshed in real-time</p>
  </div>
</div>