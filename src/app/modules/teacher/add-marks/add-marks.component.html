<div class="add-marks-container">
  
  <!-- Header -->
  <div class="marks-header">
    <h2>Add Student Marks</h2>
    <p>Enter roll number to search student and add marks for their class subjects</p>
  </div>

  <!-- Success Message -->
  <div *ngIf="submitSuccess" class="success-message">
    <mat-icon>check_circle</mat-icon>
    <div>
      <strong>Success!</strong>
      <p>Marks added successfully for {{ student?.name }}</p>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="submitError" class="error-message">
    <mat-icon>error</mat-icon>
    <div>
      <strong>Error!</strong>
      <p>{{ submitError }}</p>
    </div>
  </div>

  <!-- Main Card -->
  <mat-card class="marks-card">
    
    <!-- Card Header -->
    <div class="card-header">
      <div class="header-icon">
        <mat-icon>score</mat-icon>
      </div>
      <h1>Add Marks</h1>
      <p>Enter student marks for specific subjects</p>
    </div>

    <!-- Form Container -->
    <div class="form-container">
      
      <!-- Search Section -->
      <div class="search-section">
        <h3>
          <mat-icon>search</mat-icon>
          Search Student
        </h3>
        <div class="search-row">
          <mat-form-field appearance="outline" class="full-width search-field">
            <mat-label>Student Roll Number</mat-label>
            <input 
              matInput 
              [(ngModel)]="rollNo" 
              name="rollNo"
              placeholder="e.g., 1A01, 2A05"
              (keyup.enter)="searchStudent()"
              [disabled]="isSearching"
            >
            <mat-icon matPrefix>badge</mat-icon>
            <mat-hint>Enter student's roll number</mat-hint>
          </mat-form-field>
          <button 
            mat-raised-button 
            color="primary"
            type="button"
            (click)="searchStudent()"
            [disabled]="isSearching"
            class="search-btn"
          >
            <mat-icon>{{ isSearching ? 'hourglass_empty' : 'search' }}</mat-icon>
            {{ isSearching ? 'Searching...' : 'Search' }}
          </button>
        </div>
      </div>

      <!-- Student Details Display -->
      <div *ngIf="student" class="student-details">
        <h3>
          <mat-icon>person</mat-icon>
          Student Information
        </h3>
        <div class="details-grid">
          <div class="detail-item">
            <div class="detail-label">
              <mat-icon>person_outline</mat-icon>
              Name
            </div>
            <div class="detail-value">{{ student.name }}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">
              <mat-icon>school</mat-icon>
              Class
            </div>
            <div class="detail-value">Class {{ studentClassNumber }}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">
              <mat-icon>numbers</mat-icon>
              Roll No
            </div>
            <div class="detail-value">{{ student.rollNo }}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">
              <mat-icon>email</mat-icon>
              Email
            </div>
            <div class="detail-value">{{ student.email || 'N/A' }}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">
              <mat-icon>calendar_today</mat-icon>
              Date of Birth
            </div>
            <div class="detail-value">{{ student.dob }}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">
              <mat-icon>phone</mat-icon>
              Phone
            </div>
            <div class="detail-value">{{ student.phone || 'N/A' }}</div>
          </div>
        </div>
      </div>

      <!-- Subject List Display -->
      <div *ngIf="student && subjects.length > 0" class="subjects-list-section">
        <h3>
          <mat-icon>library_books</mat-icon>
          Class Subjects ({{ subjects.length }})
        </h3>
        <div class="subjects-list-grid">
          <div *ngFor="let subject of subjects" class="subject-badge">
            <mat-icon>subject</mat-icon>
            <span>{{ subject.subjectName }}</span>
          </div>
        </div>
      </div>

      <!-- Marks Entry Form -->
      <div *ngIf="student && subjects.length > 0" class="marks-form-section">
        <h3>
          <mat-icon>assignment</mat-icon>
          Add Marks for All Subjects
        </h3>
        <form>
          
          <!-- Subjects Grid -->
          <div class="subjects-grid">
            <div *ngFor="let subject of subjects" class="subject-marks-item">
              <div class="mark-input-container">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>{{ subject.subjectName }}</mat-label>
                  <input 
                    matInput 
                    [(ngModel)]="marksData[subject.subjectName]"
                    [name]="'marks_' + subject.subjectId"
                    type="number"
                    min="0"
                    max="100"
                    placeholder="0-100"
                    [disabled]="(existingMarks | getMarkForSubject: subject.subjectId) !== null"
                  >
                  <mat-icon matPrefix>grade</mat-icon>
                  <mat-hint>Max: 100</mat-hint>
                </mat-form-field>
                
                <!-- Existing Marks Display - Disabled Input Warning -->
                <div *ngIf="(existingMarks | getMarkForSubject: subject.subjectId) as existingMark">
                  <div class="existing-mark-badge">
                    <mat-icon>lock</mat-icon>
                    <span>Already Updated: <strong>{{ existingMark.marksObtained }}/100</strong> (Cannot Edit)</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Submitted Marks Summary -->
          <div *ngIf="submittedMarks.length > 0" class="submitted-summary">
            <h4>
              <mat-icon>list</mat-icon>
              Submitted Marks
            </h4>
            <ul>
              <li *ngFor="let mark of submittedMarks">
                <span class="subject-name">{{ mark.subject }}: {{ mark.marks }} / 100</span>
                <span [class]="mark.status === 'success' ? 'status-success' : mark.status === 'duplicate' ? 'status-duplicate' : 'status-failed'">
                  <mat-icon>{{ mark.status === 'success' ? 'check_circle' : mark.status === 'duplicate' ? 'info' : 'cancel' }}</mat-icon>
                  {{ mark.status === 'success' ? 'Success' : mark.status === 'duplicate' ? 'Already Added' : 'Failed' }}
                </span>
              </li>
            </ul>
          </div>

          <!-- Buttons -->
          <div class="button-group">
            <button 
              mat-raised-button 
              color="primary" 
              type="button"
              (click)="submitAllMarks()"
              [disabled]="isSubmitting"
              class="submit-btn"
            >
              <mat-icon>{{ isSubmitting ? 'hourglass_empty' : 'save' }}</mat-icon>
              {{ isSubmitting ? 'Submitting...' : 'Submit All Marks' }}
            </button>
            <button 
              mat-stroked-button 
              type="button"
              (click)="resetForm()"
              [disabled]="isSubmitting"
              class="reset-btn"
            >
              <mat-icon>refresh</mat-icon>
              Reset
            </button>
          </div>

          <!-- Success Message After Submission -->
          <div *ngIf="submitSuccess" class="submission-success-message">
            <mat-icon>check_circle</mat-icon>
            <div class="success-content">
              <strong>✓ All marks submitted successfully!</strong>
              <p>Marks have been saved for {{ student.name }} - {{ submittedMarks.length }} subjects updated</p>
            </div>
          </div>

        </form>
      </div>

      <!-- Empty State Message -->
      <div *ngIf="!student" class="empty-state">
        <div class="empty-icon">
          <mat-icon>person_search</mat-icon>
        </div>
        <h4>Search for Student</h4>
        <p>Enter a student roll number and click search to begin adding marks</p>
      </div>

      <!-- Info Section -->
      <div class="info-section">
        <h3>
          <mat-icon>info</mat-icon>
          Important Information
        </h3>
        <p>
          • Marks must be between 0 and 100 for each subject<br>
          • Ensure you enter marks for all required subjects<br>
          • Changes can be updated later if needed
        </p>
      </div>

    </div>
  </mat-card>

</div>